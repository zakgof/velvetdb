[![Build Status](https://travis-ci.org/zakgof/velvetdb.svg?branch=master)](https://travis-ci.org/zakgof/velvetdb)

[![Maven Central](https://maven-badges.herokuapp.com/maven-central/com.github.zakgof/velvetdb-core/badge.svg)](https://maven-badges.herokuapp.com/maven-central/com.github.zakgof/velvetdb-core)

# Overview

Velvetdb is a embedded data storage with graph-like API, perfectly fitting for small websites, desktop and mobile applications.
With zero configuration and simple API you'll need just 5 minutes to start using velvetdb.

Yes, we offer yet another persistence framework, but its design is based on principles making velvetdb distinct:
- **Least intrusive.**  
 We won't force developers to design their data model *around* the persistence framework. No need to extend framework's base classes or implement framework's interfaces. Persist your POJOs with no or minimal limitations and no or minimal framework dependencies. You can even use 3rd party model classes if needed.
- **Decoupled where possible.**  
 In our API we try to keep all concepts separated as much as possible. Entities do not know anything about their Relationships. Queries are objects that can be pre-created and separated from application's business logics.

[More on philosophy on Wiki...](https://github.com/zakgof/velvetdb/wiki/VelvetDB-vs-traditional-approach)

## Data model fundamentals
- **Data is a Graph**. Graph is a natural structure for most real data. Nodes are entities, edges represent relationships.
- **Entity** is a POJO. Basic CRUD operations are applicable.
- An entity should either have a **Primary key** or framework will assign it an autogenerated key. Range queries are supported for sortable primary keys.
- **Secondary indexes** are supported with range queries applicable.
- One-to-one, one-to-many and many-to-many **relationships** are supported. Range queries on linked entities are supported.

## Other features

- Transactional
- Pure Java 8. No xmls or other config files needed
- Choice of file storage backend: [xodus](https://github.com/JetBrains/xodus) or [mapdb](https://github.com/jankotek/mapdb)
- Pluggable serialization library (built-in serializer / [kryo] (https://github.com/EsotericSoftware/kryo) / [elsa](https://github.com/jankotek/elsa))

Coming soon:
- Schema migration support
- Android support

# Getting Started

## Maven setup

velvetdb is on Maven Central

```xml
<dependency>
    <groupId>com.github.zakgof</groupId>
    <artifactId>velvetdb-xodus</artifactId>
    <version>0.3.2</version>
</dependency>
```

## Define entities and links
```java
   public class Book {
        @Key
        private String isbn;
        private String title;
        private int year;
    }

    @Keyless
    public class Author {
        private String firstName;
        private String lastName;
    }
    
    IEntityDef<String, Book> BOOK = Entities.create(Book.class);
    IKeylessEntityDef<Author> AUTHOR = Entities.keyless(Author.class);

    IMultiLink<Long, Author, String, Book> AUTHOR_BOOKS = Links.oneToMany(AUTHOR, BOOKS);
```
## Working with velvetdb
```java
    // Get some POJOs to store
    Book book = ...
    Author author = ...

    // Use /home/velvuser/db as database folder
    IVelvetEnvironment env = VelvetFactory.open("velvetdb://xodus/home/velvuser/db"));
    
    // Run in a transaction
    env.execute(velvet -> {
    	AUTHOR.put(velvet, author);
    });
       
    // We'll skip wrapping into transaction in the subsequent examples.
    
    // Store book and connect it with its author
    BOOK.put(velvet, book);
    AUTHOR_BOOKS.connect(velvet, author, book);
    
    // Get all books
    List<Book> allBooks = BOOK.getAll(velvet);
    
    // Or fetch by a key
    Book book = BOOK.get(velvet, isbn);
    
    // Now get all books of a specific author:
    List<Book> authorsBooks = AUTHOR_BOOKS.multi(velvet, author);
```

[More on API on Wiki...](https://github.com/zakgof/velvetdb/wiki/Getting-started)
